!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/src/",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"qredraw",(function(){return L}));class r{constructor(e,t,n){this.name=e,this.x=t,this.y=n,this.w=50,this.h=50,this.ax=t,this.ay=n}draw(e,t){let{name:n,x:r,y:a,w:o,h:i}=this;e.strokeStyle=t?"yellow":"black",e.lineWidth=1,e.strokeRect(r+.5,a+.5,o,i),e.font="14px sans-serif",e.fillStyle="yellow",e.textBaseline="top",e.fillText(n,r+2,a+2),e.strokeStyle="#DDD",e.beginPath(),e.moveTo(r+o-4,a+i),e.lineTo(r+o,a+i-4),e.stroke(),e.moveTo(r+o-8,a+i),e.lineTo(r+o,a+i-8),e.stroke(),e.fillStyle="red",e.fillRect(this.ax,this.ay,1,1)}contains(e,t){return!(e<this.x)&&(!(e>this.x+this.w)&&(!(t<this.y)&&!(t>this.y+this.h)))}cornerContains(e,t){let n=this.x+this.w,r=this.y+this.h;return!(e<n-9)&&(!(e>n)&&(!(t<r-9)&&!(t>r)))}toString(){return JSON.stringify(this.toFlatObj())}toFlatObj(){return{x:this.x,y:this.y,w:this.w,h:this.h,ax:this.ax,ay:this.ay}}}class a{constructor(e,t){this.a=[],this.a[0]=e,this.a[1]=t}get x(){return this.a[0]}set x(e){this.a[0]=e}get y(){return this.a[1]}set y(e){this.a[1]=e}makeCopy(){return new a(this.x,this.y)}}const o=e=>document.getElementById(e);class i{constructor(e,t,n){this.spritesheet=e,this.frames=t,this.frameSelector=n,this.t=Date.now()}play(){this.t=Date.now()}draw(e,t,n,r,a=1){if(null==this.frameSelector)return;if(null==this.frames||0==this.frames.length)return;if(null==this.spritesheet)return;let o=Date.now()-this.t,i=this.frames[this.frameSelector(o)],s=t-(i.ax-i.x)*a,l=n-(i.ay-i.y)*a,c=i.w*a,u=i.h*a;if(r){let n=t+(i.ax-i.x)*a;e.scale(-1,1),e.drawImage(this.spritesheet,i.x,i.y,i.w,i.h,-n,l,c,u),e.scale(-1,1)}else e.drawImage(this.spritesheet,i.x,i.y,i.w,i.h,s,l,c,u)}static getLinearFrameSelector(e,t){let n=e/t;return e=>e/n>=t?t-1:Math.floor(e/n)}static getLoopingFrameSelector(e,t){let n=e/t;return e=>Math.floor(e/n)%t}static getReversingFrameSelector(e,t){if(t<2)throw RangeError("numFrames should be greater than 2.");let n=t-1,r=e/(t=2*t-2);return e=>{let a=Math.floor(e/r)%t;return n-Math.abs(n-a)}}}const s=["x","y","w","h","ax","ay"],l=s.map(e=>o("selected-"+e));function c(e){if(null!=e)for(const t in l){const n=s[t];l[t].value=e[n],l[t].onchange=()=>{e[n]=Number(l[t].value),L()}}else l.forEach(e=>e.value=e.onchange=null)}const u=o("canvas"),d=u.getContext("2d"),f=o("player-canvas"),h=f.getContext("2d"),p=[];let g=new OffscreenCanvas(u.width,u.height),y=g.getContext("2d");var m=0,v=2*m,x=0;function w(e){let t=new Image;t.src=URL.createObjectURL(e),t.addEventListener("load",(function(){let e=m,n=m,r=Math.max(u.width,t.width+v),a=x+t.height+e;!function(e,t,n,r){let a=document.createElement("canvas"),o=a.getContext("2d");a.width=e.width,a.height=e.height,o.drawImage(e,0,0),e.width=n,e.height=r,t.drawImage(a,0,0)}(g,y,r,a+n),y.drawImage(t,m,x+m),x+=t.height+e,u.width=g.width,u.height=g.height,b()}))}function b(){d.clearRect(0,0,u.width,u.height),d.drawImage(g,0,0);for(let e of p)e.draw(d,e==F);!function(){let e="",t=[];for(let n of p)e+=n.toString()+",&#10;",t.push(n.toFlatObj());k.innerHTML=e;const n=Number(M.value),r=S[R.value](n,t.length);E=new i(g,t,r)}()}function L(){setTimeout(()=>b(),0)}var E=null;const k=o("framedata-box");let S=[i.getLinearFrameSelector,i.getLoopingFrameSelector,i.getReversingFrameSelector];var T=100,O=100;requestAnimationFrame((function e(){E&&T&&O&&(h.clearRect(0,0,f.width,f.height),E.draw(h,T,O,X.checked,Number(I.value))),requestAnimationFrame(e)}));var j=new a(null,null),C=null,D=null,F=null;f.addEventListener("mousedown",e=>{e.preventDefault(),T=e.pageX-f.offsetLeft,O=e.pageY-f.offsetTop,E.play()}),u.addEventListener("contextmenu",e=>{e.preventDefault(),ctxmenu.style.left=e.pageX+"px",ctxmenu.style.top=e.pageY+"px",j.x=e.pageX-u.offsetLeft,j.y=e.pageY-u.offsetTop,ctxmenu.style.display="block";for(let e of p)if(e.contains(j.x,j.y)){F=e,c(e),L();break}}),u.addEventListener("mousedown",e=>{if(e.preventDefault(),"block"==ctxmenu.style.display)return;ctxmenu.style.display="none",j.x=e.pageX-u.offsetLeft,j.y=e.pageY-u.offsetTop;let t=e.pageX-u.offsetLeft,n=e.pageY-u.offsetTop;for(let e of p){if(e.cornerContains(t,n)){F=e,C=e,L();break}if(e.contains(t,n)){F=e,D=e,L();break}}c(F)}),u.addEventListener("mousemove",e=>{if("block"==ctxmenu.style.display)return;let t=j.makeCopy();j.x=e.pageX-u.offsetLeft,j.y=e.pageY-u.offsetTop;let n=j.x-t.x,r=j.y-t.y;null!=C?(C.w+=n,C.h+=r,L()):null!=D&&(D.x+=n,D.y+=r,L())}),u.addEventListener("mouseup",e=>{if("block"!=ctxmenu.style.display){j.x=e.pageX-u.offsetLeft,j.y=e.pageY-u.offsetTop,C=null,D=null,F=null;for(let e of p)e.contains(j.x,j.y)&&(F=e);c(F),L()}}),ctxmenu.addEventListener("contextmenu",e=>{e.preventDefault(),ctxmenu.style.display="none"}),window.addEventListener("click",e=>{ctxmenu.style.display="none"});const R=o("frames-dropdown");R.addEventListener("change",()=>{L()});const M=o("dur-input");M.addEventListener("change",()=>{o("dur-span").innerText=M.value,L()});const I=o("scale-input");I.addEventListener("change",()=>{L()});const X=o("flip-checkbox");X.addEventListener("click",()=>{L()}),o("play-btn").addEventListener("click",()=>{L()}),o("save-sheet-btn").addEventListener("click",()=>{g.convertToBlob({type:"image/png"}).then(e=>function(e,t){let n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.click()}(e,"spritesheet"))});const Y=o("padding-input");function P(){m=Y.checked?10:0,v=2*m}Y.addEventListener("change",P),P();const _=o("back-color");function B(){let e=_.value;f.style.backgroundColor=e,u.style.backgroundColor=e}B(),_.addEventListener("change",B);const N=o("file-input");function U(e){for(let t of e)w(t)}N.onchange=function(e){U(N.files)},function(e){const t=document.getElementById("drop-zone");function n(){t.classList.remove("shown")}function r(e){e.dataTransfer.dropEffect="copy",e.preventDefault()}window.addEventListener("dragenter",(function(e){t.classList.add("shown")})),t.addEventListener("dragenter",r),t.addEventListener("dragover",r),t.addEventListener("dragleave",(function(e){n()})),t.addEventListener("drop",(function(t){t.preventDefault(),n(),e.call(window,t)}))}(e=>{U(e.dataTransfer.files)}),o("clipboard-btn").addEventListener("click",(function(){k.select(),document.execCommand("copy")}));var q=0;o("new-sprite-opt").addEventListener("click",e=>{F=new r(q++,j.x,j.y),p.push(F),c(F),b()}),o("set-anchor-opt").addEventListener("click",e=>{F.ax=j.x,F.ay=j.y,c(F),b()}),o("remove-sprite-opt").addEventListener("click",e=>{for(let e=0;e<p.length;e++){if(p[e].contains(j.x,j.y))return p.splice(e,1),void L()}})}]);