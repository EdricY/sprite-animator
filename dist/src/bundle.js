!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/src/",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class o{constructor(e,t,n){this.name=e,this.x=t,this.y=n,this.w=50,this.h=50,this.ax=t,this.ay=n}draw(e,t){let{name:n,x:o,y:i,w:r,h:a}=this;e.strokeStyle=t?"yellow":"black",e.lineWidth=1,e.strokeRect(o+.5,i+.5,r,a),e.font="14px sans-serif",e.fillStyle="yellow",e.textBaseline="top",e.fillText(n,o+2,i+2),e.strokeStyle="#DDD",e.beginPath(),e.moveTo(o+r-4,i+a),e.lineTo(o+r,i+a-4),e.stroke(),e.moveTo(o+r-8,i+a),e.lineTo(o+r,i+a-8),e.stroke()}contains(e,t){return!(e<this.x)&&(!(e>this.x+this.w)&&(!(t<this.y)&&!(t>this.y+this.h)))}cornerContains(e,t){let n=this.x+this.w,o=this.y+this.h;return!(e<n-9)&&(!(e>n)&&(!(t<o-9)&&!(t>o)))}toString(){return JSON.stringify(this.toFlatObj())}toFlatObj(){return{x:this.x,y:this.y,w:this.w,h:this.h,ax:this.ax,ay:this.ay}}}class i{constructor(e,t){this.a=[],this.a[0]=e,this.a[1]=t}get x(){return this.a[0]}set x(e){this.a[0]=e}get y(){return this.a[1]}set y(e){this.a[1]=e}makeCopy(){return new i(this.x,this.y)}}const r=e=>document.getElementById(e);const a=r("canvas"),s=a.getContext("2d"),l=r("player-canvas"),c=(l.getContext("2d"),[]);let d=new OffscreenCanvas(a.width,a.height),u=d.getContext("2d");var f=0,h=2*f,p=0;function y(e){let t=new Image;t.src=URL.createObjectURL(e),t.addEventListener("load",(function(){let e=f,n=f,o=Math.max(a.width,t.width+h),i=p+t.height+e;!function(e,t,n,o){let i=document.createElement("canvas"),r=i.getContext("2d");i.width=e.width,i.height=e.height,r.drawImage(e,0,0),e.width=n,e.height=o,t.drawImage(i,0,0)}(d,u,o,i+n),u.drawImage(t,f,p+f),p+=t.height+e,a.width=d.width,a.height=d.height,g()}))}function g(){s.clearRect(0,0,a.width,a.height),s.drawImage(d,0,0);for(let e of c)e.draw(s,e==L);!function(){let e="";for(let t of c)e+=t.toString()+",&#10;";m.innerHTML=e}()}function x(){setTimeout(g,0)}const m=r("framedata-box");var v=new i(null,null),w=null,b=null,L=null;a.addEventListener("contextmenu",e=>{e.preventDefault(),ctxmenu.style.left=e.pageX+"px",ctxmenu.style.top=e.pageY+"px",v.x=e.pageX-a.offsetLeft,v.y=e.pageY-a.offsetTop,ctxmenu.style.display="block"}),a.addEventListener("mousedown",e=>{if(e.preventDefault(),"block"==ctxmenu.style.display)return;ctxmenu.style.display="none",v.x=e.pageX-a.offsetLeft,v.y=e.pageY-a.offsetTop;let t=e.pageX-a.offsetLeft,n=e.pageY-a.offsetTop;for(let e of c){if(e.cornerContains(t,n)){L=e,w=e,x();break}if(e.contains(t,n)){L=e,b=e,x();break}}}),a.addEventListener("mousemove",e=>{if("block"==ctxmenu.style.display)return;let t=v.makeCopy();v.x=e.pageX-a.offsetLeft,v.y=e.pageY-a.offsetTop;let n=v.x-t.x,o=v.y-t.y;null!=w?(w.w+=n,w.h+=o,x()):null!=b&&(b.x+=n,b.y+=o,x())}),window.addEventListener("mouseup",e=>{if("block"!=ctxmenu.style.display){v.x=e.pageX-a.offsetLeft,v.y=e.pageY-a.offsetTop,w=null,b=null,L=null;for(let e of c)e.contains(v.x,v.y)&&(L=e);x()}}),ctxmenu.addEventListener("contextmenu",e=>{e.preventDefault(),ctxmenu.style.display="none"}),window.addEventListener("click",e=>{ctxmenu.style.display="none"}),r("save-sheet-btn").addEventListener("click",()=>{d.convertToBlob({type:"image/png"}).then(e=>function(e,t){let n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.click()}(e,"spritesheet"))});const k=r("padding-input");function E(){f=k.checked?10:0,h=2*f}k.addEventListener("change",E),E();const T=r("back-color");function O(){let e=T.value;l.style.backgroundColor=e,a.style.backgroundColor=e}O(),T.addEventListener("change",O);const C=r("file-input");function j(e){for(let t of e)y(t)}C.onchange=function(e){j(C.files)},function(e){const t=document.getElementById("drop-zone");function n(){t.classList.remove("shown")}function o(e){e.dataTransfer.dropEffect="copy",e.preventDefault()}window.addEventListener("dragenter",(function(e){t.classList.add("shown")})),t.addEventListener("dragenter",o),t.addEventListener("dragover",o),t.addEventListener("dragleave",(function(e){n()})),t.addEventListener("drop",(function(t){t.preventDefault(),n(),e.call(window,t)}))}(e=>{j(e.dataTransfer.files)}),r("clipboard-btn").addEventListener("click",(function(){m.select(),document.execCommand("copy")}));var S=0;r("new-sprite-opt").addEventListener("click",e=>{c.push(new o(S++,v.x,v.y)),g()}),r("set-anchor-opt").addEventListener("click",e=>{g()}),r("remove-sprite-opt").addEventListener("click",e=>{for(let e=0;e<c.length;e++){if(c[e].contains(v.x,v.y))return c.splice(e,1),void x()}})}]);