!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/src/",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"qredraw",(function(){return L}));class r{constructor(e,t,n){this.name=e,this.x=t,this.y=n,this.w=50,this.h=50,this.ax=t,this.ay=n}draw(e,t){let{name:n,x:r,y:a,w:i,h:o}=this;e.strokeStyle=t?"yellow":"black",e.lineWidth=1,e.strokeRect(r+.5,a+.5,i,o),e.font="14px sans-serif",e.fillStyle="yellow",e.textBaseline="top",e.fillText(n,r+2,a+2),e.strokeStyle="#DDD",e.beginPath(),e.moveTo(r+i-4,a+o),e.lineTo(r+i,a+o-4),e.stroke(),e.moveTo(r+i-8,a+o),e.lineTo(r+i,a+o-8),e.stroke(),e.fillStyle="red",e.fillRect(this.ax,this.ay,1,1)}contains(e,t){return!(e<this.x)&&(!(e>this.x+this.w)&&(!(t<this.y)&&!(t>this.y+this.h)))}cornerContains(e,t){let n=this.x+this.w,r=this.y+this.h;return!(e<n-9)&&(!(e>n)&&(!(t<r-9)&&!(t>r)))}toString(){return JSON.stringify(this.toFlatObj())}toFlatObj(){return{x:this.x,y:this.y,w:this.w,h:this.h,ax:this.ax,ay:this.ay}}}class a{constructor(e,t){this.a=[],this.a[0]=e,this.a[1]=t}get x(){return this.a[0]}set x(e){this.a[0]=e}get y(){return this.a[1]}set y(e){this.a[1]=e}makeCopy(){return new a(this.x,this.y)}}const i=e=>document.getElementById(e);class o{constructor(e,t,n){this.spritesheet=e,this.frames=t,this.frameSelector=n,this.t=Date.now()}play(){this.t=Date.now()}draw(e,t,n,r,a=1){if(null==this.frameSelector)return;if(null==this.frames||0==this.frames.length)return;if(null==this.spritesheet)return;let i=Date.now()-this.t,o=this.frames[this.frameSelector(i)],s=t-(o.ax-o.x)*a,l=n-(o.ay-o.y)*a,c=o.w*a,d=o.h*a;if(r){let n=t+(o.ax-o.x)*a;e.scale(-1,1),e.drawImage(this.spritesheet,o.x,o.y,o.w,o.h,-n,l,c,d),e.scale(-1,1)}else e.drawImage(this.spritesheet,o.x,o.y,o.w,o.h,s,l,c,d)}static getLinearFrameSelector(e,t){let n=e/t;return e=>e/n>=t?t-1:Math.floor(e/n)}static getLoopingFrameSelector(e,t){let n=e/t;return e=>Math.floor(e/n)%t}static getReversingFrameSelector(e,t){if(t<2)throw RangeError("numFrames should be greater than 2.");let n=t-1,r=e/(t=2*t-2);return e=>{let a=Math.floor(e/r)%t;return n-Math.abs(n-a)}}}const s=["x","y","w","h","ax","ay"],l=s.map(e=>i("selected-"+e));function c(e){if(null!=e)for(const t in l){const n=s[t];l[t].value=e[n],l[t].onchange=()=>{e[n]=Number(l[t].value),L()}}else l.forEach(e=>e.value=e.onchange=null)}const d=i("canvas"),u=d.getContext("2d"),f=i("player-canvas"),h=f.getContext("2d"),p=[];let g=new OffscreenCanvas(d.width,d.height),y=g.getContext("2d");var m=0,v=2*m,x=0;function w(e){let t=new Image;t.src=URL.createObjectURL(e),t.addEventListener("load",(function(){let e=m,n=m,r=Math.max(d.width,t.width+v),a=x+t.height+e;!function(e,t,n,r){let a=document.createElement("canvas"),i=a.getContext("2d");a.width=e.width,a.height=e.height,i.drawImage(e,0,0),e.width=n,e.height=r,t.drawImage(a,0,0)}(g,y,r,a+n),y.drawImage(t,m,x+m),x+=t.height+e,d.width=g.width,d.height=g.height,b()}))}function b(){u.clearRect(0,0,d.width,d.height),u.drawImage(g,0,0);for(let e of p)e.draw(u,e==R);!function(){let e="",t=[];for(let n of p)e+=n.toString()+",&#10;",t.push(n.toFlatObj());E.innerHTML=e;const n=Number(M.value),r=S[C.value](n,t.length);k=new o(g,t,r)}()}function L(){setTimeout(()=>b(),0)}var k=null;const E=i("framedata-box");let S=[o.getLinearFrameSelector,o.getLoopingFrameSelector,o.getReversingFrameSelector];var T=100,O=100;requestAnimationFrame((function e(){k&&T&&O&&(h.clearRect(0,0,f.width,f.height),k.draw(h,T,O,X.checked,Number(I.value))),requestAnimationFrame(e)}));var j=new a(null,null),D=null,F=null,R=null;f.addEventListener("mousedown",e=>{e.preventDefault(),T=e.pageX-f.offsetLeft,O=e.pageY-f.offsetTop,k.play()}),d.addEventListener("contextmenu",e=>{e.preventDefault(),ctxmenu.style.left=e.pageX+"px",ctxmenu.style.top=e.pageY+"px",j.x=e.pageX-d.offsetLeft,j.y=e.pageY-d.offsetTop,ctxmenu.style.display="block";for(let e of p)if(e.contains(j.x,j.y)){R=e,c(e),L();break}}),d.addEventListener("mousedown",e=>{if(e.preventDefault(),"block"==ctxmenu.style.display)return;ctxmenu.style.display="none",j.x=e.pageX-d.offsetLeft,j.y=e.pageY-d.offsetTop;let t=e.pageX-d.offsetLeft,n=e.pageY-d.offsetTop;for(let e of p){if(e.cornerContains(t,n)){R=e,D=e,L();break}if(e.contains(t,n)){R=e,F=e,L();break}}c(R)}),d.addEventListener("mousemove",e=>{if("block"==ctxmenu.style.display)return;let t=j.makeCopy();j.x=e.pageX-d.offsetLeft,j.y=e.pageY-d.offsetTop;let n=j.x-t.x,r=j.y-t.y;null!=D?(D.w+=n,D.h+=r,L()):null!=F&&(F.x+=n,F.y+=r,L())}),d.addEventListener("mouseup",e=>{if("block"!=ctxmenu.style.display){j.x=e.pageX-d.offsetLeft,j.y=e.pageY-d.offsetTop,D=null,F=null,R=null;for(let e of p)e.contains(j.x,j.y)&&(R=e);c(R),L()}}),ctxmenu.addEventListener("contextmenu",e=>{e.preventDefault(),ctxmenu.style.display="none"}),window.addEventListener("click",e=>{ctxmenu.style.display="none"});const C=i("frames-dropdown");C.addEventListener("change",()=>{L()});const M=i("dur-input");M.addEventListener("change",()=>{i("dur-span").innerText=M.value,L()});const I=i("scale-input");I.addEventListener("change",()=>{L()});const X=i("flip-checkbox");X.addEventListener("click",()=>{L()}),i("play-btn").addEventListener("click",()=>{L()}),i("save-sheet-btn").addEventListener("click",()=>{g.convertToBlob({type:"image/png"}).then(e=>function(e,t){let n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.click()}(e,"spritesheet"))});const Y=i("padding-input");function P(){m=Y.checked?10:0,v=2*m}Y.addEventListener("change",P),P();const _=i("back-color"),B=i("checkerboard-checkbox");function N(){let e=_.value;_.disabled=!1,B.checked&&(e="",_.disabled=!0),f.style.background=e,d.style.background=e}N(),_.addEventListener("change",N),B.addEventListener("change",N);const U=i("file-input");function q(e){for(let t of e)w(t)}U.onchange=function(e){q(U.files)},function(e){const t=document.getElementById("drop-zone");function n(){t.classList.remove("shown")}function r(e){e.dataTransfer.dropEffect="copy",e.preventDefault()}window.addEventListener("dragenter",(function(e){t.classList.add("shown")})),t.addEventListener("dragenter",r),t.addEventListener("dragover",r),t.addEventListener("dragleave",(function(e){n()})),t.addEventListener("drop",(function(t){t.preventDefault(),n(),e.call(window,t)}))}(e=>{q(e.dataTransfer.files)}),i("clipboard-btn").addEventListener("click",(function(){E.select(),document.execCommand("copy")}));var A=0;i("new-sprite-opt").addEventListener("click",e=>{R=new r(A++,j.x,j.y),p.push(R),c(R),b()}),i("set-anchor-opt").addEventListener("click",e=>{R.ax=j.x,R.ay=j.y,c(R),b()}),i("remove-sprite-opt").addEventListener("click",e=>{for(let e=0;e<p.length;e++){if(p[e].contains(j.x,j.y))return p.splice(e,1),void L()}})}]);